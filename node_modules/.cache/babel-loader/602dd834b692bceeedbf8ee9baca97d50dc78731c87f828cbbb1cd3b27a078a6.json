{"ast":null,"code":"import _objectSpread from\"c:/casse-web/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{collection,addDoc,getDocs,doc,updateDoc,deleteDoc,query,orderBy,where,getDoc}from'firebase/firestore';import{ref,uploadBytes,getDownloadURL,deleteObject}from'firebase/storage';import{db,storage}from'./firebase';export const articlesService={// Crear artículo\nasync createArticle(articleData){let images=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];try{const imageUrls=[];// Subir imágenes\nfor(const image of images){const imageRef=ref(storage,\"articles/\".concat(Date.now(),\"_\").concat(image.name));const snapshot=await uploadBytes(imageRef,image);const url=await getDownloadURL(snapshot.ref);imageUrls.push(url);}const docRef=await addDoc(collection(db,'articulos'),_objectSpread(_objectSpread({},articleData),{},{fotos:imageUrls,createdAt:new Date(),updatedAt:new Date()}));return docRef.id;}catch(error){console.error('Error creating article:',error);throw error;}},// Obtener todos los artículos\nasync getAllArticles(){try{const q=query(collection(db,'articulos'),orderBy('createdAt','desc'));const querySnapshot=await getDocs(q);return querySnapshot.docs.map(doc=>_objectSpread({id:doc.id,uuid:doc.id},doc.data()));}catch(error){console.error('Error getting articles:',error);throw error;}},// Obtener artículo por ID\nasync getArticleById(id){try{const docRef=doc(db,'articulos',id);const docSnap=await getDoc(docRef);if(docSnap.exists()){return _objectSpread({id:docSnap.id,uuid:docSnap.id},docSnap.data());}return null;}catch(error){console.error('Error getting article:',error);throw error;}},// Actualizar artículo\nasync updateArticle(id,articleData){let newImages=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];let removedImages=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];try{// Eliminar imágenes removidas\nfor(const imageUrl of removedImages){try{const imageRef=ref(storage,imageUrl);await deleteObject(imageRef);}catch(error){console.warn('Error deleting image:',error);}}// Subir nuevas imágenes\nconst newImageUrls=[];for(const image of newImages){const imageRef=ref(storage,\"articles/\".concat(Date.now(),\"_\").concat(image.name));const snapshot=await uploadBytes(imageRef,image);const url=await getDownloadURL(snapshot.ref);newImageUrls.push(url);}const docRef=doc(db,'articulos',id);await updateDoc(docRef,_objectSpread(_objectSpread({},articleData),{},{fotos:[...(articleData.fotos||[]),...newImageUrls],updatedAt:new Date()}));return true;}catch(error){console.error('Error updating article:',error);throw error;}},// Eliminar artículo\nasync deleteArticle(id){try{// Obtener el artículo para eliminar sus imágenes\nconst article=await this.getArticleById(id);if(article&&article.fotos){// Eliminar imágenes del storage\nfor(const imageUrl of article.fotos){try{const imageRef=ref(storage,imageUrl);await deleteObject(imageRef);}catch(error){console.warn('Error deleting image:',error);}}}// Eliminar documento\nawait deleteDoc(doc(db,'articulos',id));return true;}catch(error){console.error('Error deleting article:',error);throw error;}},// Buscar artículos\nasync searchArticles(searchTerm){try{const q=query(collection(db,'articulos'),orderBy('createdAt','desc'));const querySnapshot=await getDocs(q);const articles=querySnapshot.docs.map(doc=>_objectSpread({id:doc.id,uuid:doc.id},doc.data()));// Filtrar en el cliente\nreturn articles.filter(article=>{var _article$titulo,_article$descripcion,_article$tags;return((_article$titulo=article.titulo)===null||_article$titulo===void 0?void 0:_article$titulo.toLowerCase().includes(searchTerm.toLowerCase()))||((_article$descripcion=article.descripcion)===null||_article$descripcion===void 0?void 0:_article$descripcion.toLowerCase().includes(searchTerm.toLowerCase()))||((_article$tags=article.tags)===null||_article$tags===void 0?void 0:_article$tags.some(tag=>tag.toLowerCase().includes(searchTerm.toLowerCase())));});}catch(error){console.error('Error searching articles:',error);throw error;}}};","map":{"version":3,"names":["collection","addDoc","getDocs","doc","updateDoc","deleteDoc","query","orderBy","where","getDoc","ref","uploadBytes","getDownloadURL","deleteObject","db","storage","articlesService","createArticle","articleData","images","arguments","length","undefined","imageUrls","image","imageRef","concat","Date","now","name","snapshot","url","push","docRef","_objectSpread","fotos","createdAt","updatedAt","id","error","console","getAllArticles","q","querySnapshot","docs","map","uuid","data","getArticleById","docSnap","exists","updateArticle","newImages","removedImages","imageUrl","warn","newImageUrls","deleteArticle","article","searchArticles","searchTerm","articles","filter","_article$titulo","_article$descripcion","_article$tags","titulo","toLowerCase","includes","descripcion","tags","some","tag"],"sources":["c:/casse-web/src/services/articlesService.js"],"sourcesContent":["import { \n  collection, \n  addDoc, \n  getDocs, \n  doc, \n  updateDoc, \n  deleteDoc, \n  query, \n  orderBy, \n  where,\n  getDoc \n} from 'firebase/firestore';\nimport { ref, uploadBytes, getDownloadURL, deleteObject } from 'firebase/storage';\nimport { db, storage } from './firebase';\n\nexport const articlesService = {\n  // Crear artículo\n  async createArticle(articleData, images = []) {\n    try {\n      const imageUrls = [];\n      \n      // Subir imágenes\n      for (const image of images) {\n        const imageRef = ref(storage, `articles/${Date.now()}_${image.name}`);\n        const snapshot = await uploadBytes(imageRef, image);\n        const url = await getDownloadURL(snapshot.ref);\n        imageUrls.push(url);\n      }\n\n      const docRef = await addDoc(collection(db, 'articulos'), {\n        ...articleData,\n        fotos: imageUrls,\n        createdAt: new Date(),\n        updatedAt: new Date()\n      });\n\n      return docRef.id;\n    } catch (error) {\n      console.error('Error creating article:', error);\n      throw error;\n    }\n  },\n\n  // Obtener todos los artículos\n  async getAllArticles() {\n    try {\n      const q = query(collection(db, 'articulos'), orderBy('createdAt', 'desc'));\n      const querySnapshot = await getDocs(q);\n      return querySnapshot.docs.map(doc => ({\n        id: doc.id,\n        uuid: doc.id,\n        ...doc.data()\n      }));\n    } catch (error) {\n      console.error('Error getting articles:', error);\n      throw error;\n    }\n  },\n\n  // Obtener artículo por ID\n  async getArticleById(id) {\n    try {\n      const docRef = doc(db, 'articulos', id);\n      const docSnap = await getDoc(docRef);\n      \n      if (docSnap.exists()) {\n        return {\n          id: docSnap.id,\n          uuid: docSnap.id,\n          ...docSnap.data()\n        };\n      }\n      return null;\n    } catch (error) {\n      console.error('Error getting article:', error);\n      throw error;\n    }\n  },\n\n  // Actualizar artículo\n  async updateArticle(id, articleData, newImages = [], removedImages = []) {\n    try {\n      // Eliminar imágenes removidas\n      for (const imageUrl of removedImages) {\n        try {\n          const imageRef = ref(storage, imageUrl);\n          await deleteObject(imageRef);\n        } catch (error) {\n          console.warn('Error deleting image:', error);\n        }\n      }\n\n      // Subir nuevas imágenes\n      const newImageUrls = [];\n      for (const image of newImages) {\n        const imageRef = ref(storage, `articles/${Date.now()}_${image.name}`);\n        const snapshot = await uploadBytes(imageRef, image);\n        const url = await getDownloadURL(snapshot.ref);\n        newImageUrls.push(url);\n      }\n\n      const docRef = doc(db, 'articulos', id);\n      await updateDoc(docRef, {\n        ...articleData,\n        fotos: [...(articleData.fotos || []), ...newImageUrls],\n        updatedAt: new Date()\n      });\n\n      return true;\n    } catch (error) {\n      console.error('Error updating article:', error);\n      throw error;\n    }\n  },\n\n  // Eliminar artículo\n  async deleteArticle(id) {\n    try {\n      // Obtener el artículo para eliminar sus imágenes\n      const article = await this.getArticleById(id);\n      \n      if (article && article.fotos) {\n        // Eliminar imágenes del storage\n        for (const imageUrl of article.fotos) {\n          try {\n            const imageRef = ref(storage, imageUrl);\n            await deleteObject(imageRef);\n          } catch (error) {\n            console.warn('Error deleting image:', error);\n          }\n        }\n      }\n\n      // Eliminar documento\n      await deleteDoc(doc(db, 'articulos', id));\n      return true;\n    } catch (error) {\n      console.error('Error deleting article:', error);\n      throw error;\n    }\n  },\n\n  // Buscar artículos\n  async searchArticles(searchTerm) {\n    try {\n      const q = query(collection(db, 'articulos'), orderBy('createdAt', 'desc'));\n      const querySnapshot = await getDocs(q);\n      \n      const articles = querySnapshot.docs.map(doc => ({\n        id: doc.id,\n        uuid: doc.id,\n        ...doc.data()\n      }));\n\n      // Filtrar en el cliente\n      return articles.filter(article => \n        article.titulo?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        article.descripcion?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        article.tags?.some(tag => tag.toLowerCase().includes(searchTerm.toLowerCase()))\n      );\n    } catch (error) {\n      console.error('Error searching articles:', error);\n      throw error;\n    }\n  }\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}